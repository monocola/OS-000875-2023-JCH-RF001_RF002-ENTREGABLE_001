<div class="body">
  <div class="d-flex">
    <a routerLink="../" class="back-arrow pt-1 mr-1">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M15.41 7.41L14 6L8 12L14 18L15.41 16.59L10.83 12L15.41 7.41Z"
          fill="#024487"
        />
      </svg>
    </a>
    <h3 class="titlePage">Editar Servidor Civil</h3>
    <span class="flex-spacer"></span>
  </div>

  <div class="m-1 p-1"></div>

  <mat-tab-group (selectedTabChange)="onTabChanged($event)" mat-align-tabs="start">
    <mat-tab label="Datos Personales">
      <div class="bg-card m-1" [formGroup]="registerForm">
        <div class="row">
          <div class="col-md-2 col-sm-4">
            <label>Apellido Paterno</label>
            <input
              trim="blur"
              placeholder="Ingresar"
              nbInput
              shape="semi-round"
              fullWidth
              [status]="
                f.apellidoPaterno.invalid && f.apellidoPaterno.touched
                  ? 'danger'
                  : 'basic'
              "
              formControlName="apellidoPaterno"
            />

            <div
              *ngIf="f.apellidoPaterno.invalid && f.apellidoPaterno.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.apellidoPaterno.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-2 col-sm-4">
            <label>Apellido Materno</label>
            <input
              trim="blur"
              placeholder="Ingresar"
              nbInput
              shape="semi-round"
              fullWidth
              [status]="
                f.apellidoMaterno.invalid && f.apellidoMaterno.touched
                  ? 'danger'
                  : 'basic'
              "
              formControlName="apellidoMaterno"
            />

            <div
              *ngIf="f.apellidoMaterno.invalid && f.apellidoMaterno.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.apellidoMaterno.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-4 col-sm-8">
            <label>Nombres</label>
            <input
              trim="blur"
              placeholder="Ingresar"
              nbInput
              shape="semi-round"
              fullWidth
              [status]="
                f.nombres.invalid && f.nombres.touched ? 'danger' : 'basic'
              "
              formControlName="nombres"
            />

            <div
              *ngIf="f.nombres.invalid && f.nombres.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.nombres.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-2 col-sm-4">
            <label>Género</label>
            <nb-select
              formControlName="genero"
              placeholder="Seleccione"
              fullWidth="true"
              [size]="'large'"
              [compareWith]="compareById"
              shape="semi-round"
              [status]="
                f.genero.invalid && f.genero.touched ? 'danger' : 'basic'
              "
            >
              <nb-option value="">Seleccione</nb-option>
              <nb-option *ngFor="let g of generos" [value]="g.codigoTexto">{{
                g.valorTexto
              }}</nb-option>
            </nb-select>

            <div
              *ngIf="f.genero.invalid && f.genero.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.genero.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-2 col-sm-4">
            <label>Fecha de Nacimiento</label>

            <nb-form-field>
              <input
                id="fechaNacimiento"
                #fechaNacimiento
                formControlName="fechaNacimiento"
                nbInput
                placeholder="dd/mm/aaaa"
                [nbDatepicker]="formpickerNacimiento"
                fieldSize="large"
                shape="semi-round"
                [status]="
                  f.fechaNacimiento.invalid && f.fechaNacimiento.touched
                    ? 'danger'
                    : 'basic'
                "
              />

              <nb-icon
                style="cursor: pointer"
                nbSuffix
                class="mr-2"
                icon="calendar-outline"
                (click)="fechaNacimiento.click()"
              >
                <span class="material-icons gray00">face</span>
              </nb-icon>
              <nb-datepicker #formpickerNacimiento></nb-datepicker>
            </nb-form-field>

            <div
              *ngIf="f.fechaNacimiento.invalid && f.fechaNacimiento.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.fechaNacimiento.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
        </div>

        <div class="row mt-2">
          <div class="col-md-2 col-sm-4">
            <label>Tipo Doc. Identidad</label>
            <nb-select
              formControlName="tipoDocumentoIdentidad"
              placeholder="Seleccione"
              fullWidth="true"
              [size]="'large'"
              shape="semi-round"
              [status]="
                f.tipoDocumentoIdentidad.invalid &&
                f.tipoDocumentoIdentidad.touched
                  ? 'danger'
                  : 'basic'
              "
            >
              <nb-option value="">Seleccione</nb-option>
              <nb-option
                *ngFor="let td of tiposDocumento"
                [value]="td.valorTexto"
                >{{ td.valorTexto }}</nb-option
              >
            </nb-select>

            <div
              *ngIf="
                f.tipoDocumentoIdentidad.invalid &&
                f.tipoDocumentoIdentidad.touched
              "
              class="invalid-text flex-column"
            >
              <span *ngIf="f.tipoDocumentoIdentidad.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-2 col-sm-4">
            <label>N° Doc. Identidad</label>
            <input
              trim="blur"
              placeholder="Ingresar"
              nbInput
              shape="semi-round"
              fullWidth
              [status]="
                f.numeroDocumentoIdentidad.invalid &&
                f.numeroDocumentoIdentidad.touched
                  ? 'danger'
                  : 'basic'
              "
              formControlName="numeroDocumentoIdentidad"
            />

            <div
              *ngIf="
                f.numeroDocumentoIdentidad.invalid &&
                f.numeroDocumentoIdentidad.touched
              "
              class="invalid-text flex-column"
            >
              <span *ngIf="f.numeroDocumentoIdentidad.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-4 col-sm-8">
            <label>Correo electrónico institucional</label>
            <input
              trim="blur"
              placeholder="Ingresar"
              nbInput
              shape="semi-round"
              fullWidth
              [status]="
                f.correo.invalid && f.correo.touched ? 'danger' : 'basic'
              "
              formControlName="correo"
            />

            <div
              *ngIf="f.correo.invalid && f.correo.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.correo.errors.required">
                El campo es obligatorio
              </span>
              <span *ngIf="f.correo.errors.email">
                Debe ingresar un correo electrónico válido
              </span>
            </div>
          </div>
          <div class="col-md-2 col-sm-4">
            <label>Régimen Laboral</label>
            <nb-select
              formControlName="regimenLaboralId"
              placeholder="Seleccione"
              fullWidth="true"
              [size]="'large'"
              shape="semi-round"
              [status]="
                f.regimenLaboralId.invalid && f.regimenLaboralId.touched
                  ? 'danger'
                  : 'basic'
              "
            >
              <nb-option value="">Seleccione</nb-option>
              <nb-option
                *ngFor="let s of tiposRegimen"
                [value]="s.codigoNumero"
                >{{ s.valorTexto }}</nb-option
              >
            </nb-select>

            <div
              *ngIf="f.regimenLaboralId.invalid && f.regimenLaboralId.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.regimenLaboralId.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
          <div class="col-md-2 col-sm-4">
            <label>Sindicato</label>
            <nb-select
              formControlName="sindicato"
              placeholder="Seleccione"
              fullWidth="true"
              [size]="'large'"
              shape="semi-round"
              [status]="
                f.sindicato.invalid && f.sindicato.touched ? 'danger' : 'basic'
              "
            >
              <nb-option value="">Seleccione</nb-option>
              <nb-option
                *ngFor="let s of sindicatos"
                [value]="s.codigoNumero"
                >{{ s.valorTexto }}</nb-option
              >
            </nb-select>

            <div
              *ngIf="f.sindicato.invalid && f.sindicato.touched"
              class="invalid-text flex-column"
            >
              <span *ngIf="f.sindicato.errors.required">
                El campo es obligatorio
              </span>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col text-center">
            <button
              nbButton
              shape="round"
              size="medium"
              status="primary"
              class="pl-5 pr-5"
              (click)="actualizar()"
              style="background-color: #249eaf"
            >
              Guardar
            </button>
          </div>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Puesto">
      <div class="bg-card0 m-1" [formGroup]="registerFormPuesto">
        <div class="panel-tab p-4 mb-4">
          <div class="row">
            <label class="col-12 label-header"
              >Ingrese los siguientes datos</label
            >
          </div>
          <div class="row mt-2">
            <div class="col-sm-6">
              <label>Órgano / UO / Sub UO</label>
              <nb-select
                formControlName="organo"
                placeholder="Seleccione"
                fullWidth="true"
                [size]="'large'"
                shape="semi-round"
                [status]="
                  fp.organo.invalid && fp.organo.touched ? 'danger' : 'basic'
                "
                (selectedChange)="onSelectionChangeUO($event)"
              >
                <nb-option value="">Seleccione</nb-option>
                <nb-option *ngFor="let uo of unidadesOrganicas" [value]="uo.id"
                  >{{ uo.sigla }} - {{ uo.descripcion }}</nb-option
                >
              </nb-select>

              <div
                *ngIf="fp.organo.invalid && fp.organo.touched"
                class="invalid-text flex-column"
              >
                <span *ngIf="fp.organo.errors.required">
                  El campo es obligatorio
                </span>
              </div>
            </div>
            <div class="col-sm-3">
              <label>Puesto</label>
              <nb-select
                formControlName="puestoId"
                placeholder="Seleccione"
                fullWidth="true"
                [size]="'large'"
                shape="semi-round"
                [status]="
                  fp.puestoId.invalid && fp.puestoId.touched
                    ? 'danger'
                    : 'basic'
                "
                (selectedChange)="actualizarEncargados()"
              >
                <nb-option value="">Seleccione</nb-option>
                <nb-option
                  *ngFor="let uo of listaPuestos"
                  [value]="uo.puestoId"
                  >{{ uo.nombrePuesto }}</nb-option
                >
              </nb-select>

              <div
                *ngIf="fp.puestoId.invalid && fp.puestoId.touched"
                class="invalid-text flex-column"
              >
                <span *ngIf="fp.puestoId.errors.required">
                  El campo es obligatorio
                </span>
              </div>
            </div>
            <div class="col-sm-3">
              <label>Fecha de inicio</label>
              <nb-form-field>
                <input
                  id="fechaInicio"
                  #fechaInicio
                  formControlName="fechaInicio"
                  nbInput
                  placeholder="dd/mm/aaaa"
                  [nbDatepicker]="formpicker"
                  fieldSize="large"
                  shape="semi-round"
                  [status]="
                    fp.fechaInicio.invalid && fp.fechaInicio.touched
                      ? 'danger'
                      : 'basic'
                  "
                />

                <nb-icon
                  style="cursor: pointer"
                  nbSuffix
                  class="mr-2"
                  icon="calendar-outline"
                  (click)="fechaInicio.click()"
                >
                  <span class="material-icons gray00">face</span>
                </nb-icon>
                <nb-datepicker #formpicker></nb-datepicker>
              </nb-form-field>

              <div
                *ngIf="fp.fechaInicio.invalid && fp.fechaInicio.touched"
                class="invalid-text flex-column"
              >
                <span *ngIf="fp.fechaInicio.errors.required">
                  El campo es obligatorio
                </span>
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-sm-6">
              <label>Servidor(a) a reemplazar</label>
              <nb-select
                formControlName="personaAsignada"
                placeholder="Seleccione"
                fullWidth="true"
                [size]="'large'"
                shape="semi-round"
                [status]="
                  fp.personaAsignada.invalid && fp.personaAsignada.touched
                    ? 'danger'
                    : 'basic'
                "
              >
                <nb-option value="">Seleccione</nb-option>
                <nb-option
                  *ngFor="let e of listaEncargados"
                  [value]="e.detalleuoId"
                >
                  {{ e.apellidoPaterno }} {{ e.apellidoMaterno }}
                  {{ e.nombres }}
                </nb-option>
              </nb-select>

              <div
                *ngIf="fp.personaAsignada.invalid && fp.personaAsignada.touched"
                class="invalid-text flex-column"
              >
                <span *ngIf="fp.personaAsignada.errors.required">
                  El campo es obligatorio
                </span>
              </div>
            </div>
            <div class="col-sm-3">
              <label>Motivo de encargatura</label>
              <nb-select
                formControlName="motivoId"
                placeholder="Seleccione"
                fullWidth="true"
                [size]="'large'"
                shape="semi-round"
                [status]="
                  (fp.motivoId.invalid && fp.motivoId.touched) ||
                  registerFormPuesto.hasError('noCese')
                    ? 'danger'
                    : 'basic'
                "
              >
                <nb-option value="">Seleccione</nb-option>
                <nb-option
                  *ngFor="let ta of listMotivosEncarturas"
                  [value]="ta.codigoNumero"
                  >{{ ta.valorTexto }}</nb-option
                >
              </nb-select>

              <div
                *ngIf="fp.motivoId.invalid && fp.motivoId.touched"
                class="invalid-text flex-column"
              >
                <span *ngIf="fp.motivoId.errors.required">
                  El campo es obligatorio
                </span>
              </div>
              <span
                *ngIf="registerFormPuesto.hasError('noCese')"
                class="invalid-text flex-column"
              >
                Para seleccionar este motivo primero debe cesar al Servidor
                Civil seleccionado
              </span>
            </div>
            <div
              class="col-sm-3 text-right d-flex align-items-end justify-content-end"
            >
              <button
                nbButton
                shape="round"
                size="medium"
                status="primary"
                class="px-5"
                (click)="encargarPuesto()"
                style="color: white; background-color: #249eaf"
              >
                Encargar puesto
              </button>
            </div>
          </div>
        </div>

        <div class="row">
          <label class="col-12 label-header">Historial de Puestos</label>
        </div>
        <div>
          <gme-web-table
            holderText="Historial de puestos"
            [tableData]="this.listaPuestosTablas"
            [tableColumns]="columnasTablaPuestos"
            [isFilterable]="false"
            [isPageable]="false"
            [paginationSizes]="[10, 20, 50, 100]"
            [defaultPageSize]="10"
            [acciones]="true"
            [title]="'Historial de Puestos'"
            [btnEditEnabled]="true"
            (editAction)="editPuesto($event)"
            [editTitle]="'Editar puesto'"
            [btnDeleteEnabled]="false"
            (deleteAction)="removePuesto($event)"
            [deleteTitle]="'Eliminar puesto'"
            [showDownloadButton]="false"
            [dataExport]="getDataExport()"
          ></gme-web-table>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
