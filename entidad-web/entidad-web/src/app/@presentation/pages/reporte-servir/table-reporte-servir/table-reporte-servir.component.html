<div style="display: flex">
  <span class="subtitle" style="flex: 1 0">{{ title }}</span>
  <mat-paginator
    showFirstLastButtons
    [pageSizeOptions]="paginationSizes"
    [pageSize]="defaultPageSize"
    [pageIndex]="pageIndex"
    [length]="tamanio"
    (page)="pageEvent.emit($event)"
  >
  </mat-paginator>
</div>

<table
  mat-table
  aria-describedby="material-table"
  class="mat-elevation-z7 mt-2"
  matSort
  [dataSource]="tableDataSource"
  (matSortChange)="sortTable($event)"
>
  <ng-container [matColumnDef]="'entidad'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'entidad'"
      [arrowPosition]="'after'"
    >
      ENTIDAD
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.entidad }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'codConvocatoria'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'codConvocatoria'"
      [arrowPosition]="'after'"
    >
      COD CONVOC.
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.codConvocatoria }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'cronograma'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'cronograma'"
      [arrowPosition]="'after'"
    >
      CRONOGRAMA
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.cronograma || '--' }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'regimen'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'regimen'"
      [arrowPosition]="'after'"
    >
      REGIMEN
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.regimen }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'vacantes'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'perfiles_vacantes'"
      [arrowPosition]="'after'"
    >
      VACANTES
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.perfiles_vacantes }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'gestor'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'gestor'"
      [arrowPosition]="'after'"
    >
      GESTOR ORH
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.gestor }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'postulantes'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'perfiles_postulantes'"
      [arrowPosition]="'after'"
    >
      POSTULANTES
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.perfiles_postulantes }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'responsable'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'responsable'"
      [arrowPosition]="'after'"
    >
      COORDINADOR
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.coordinador }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'perfiles'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'perfiles'"
      [arrowPosition]="'after'"
    >
      PERFILES
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13 d-flex">
        <span style="margin-top: 2px;">{{ element.perfiles_length }}</span>
        &nbsp;
        <button [nbPopover]="templateRef" nbPopoverPlacement="right" matRipple title="Ver perfiles" class="btnCheck">
          <mat-icon class="add-icon">control_point</mat-icon>
        </button>

        <ng-template #templateRef>
          <div class="template-body fs-13">
            <div class="table-color">
              <div class="row table-header">
                <div class="col-6 perfiles">PERFIL</div>
                <div class="col-6 vacantes">VACANTES</div>
              </div>
              <div  class="table-body" *ngFor="let item of element.perfiles; last as isLast">
                <div [class.border-bottom]="!isLast" class="row m-0 table-content">
                  <div class="primary-color col-6" style="padding-left: 3px !important;">
                    {{ capitalizeFirstLetter (item.nombre) }}
                  </div>
                  <div class="col-6 text-center">
                    {{ item.vacantes || '-' }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'etapa'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'etapa'"
      [arrowPosition]="'after'"
    >
      ETAPA
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div class="fs-13">
        <span>
          {{ element.etapa }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container [matColumnDef]="'condicion'">
    <th
      scope="col"
      style="width: 10%"
      mat-header-cell
      *matHeaderCellDef
      [mat-sort-header]="'estado'"
      [arrowPosition]="'after'"
    >
      EST. CONV.
    </th>
    <td mat-cell *matCellDef="let element" class="text-left">
      <div
        class="fs-11 statusSpan text-center"
        [ngClass]="{
          statusProceso: element.estadoId === const.EST_CONV_PROC,
          statusDesierta:
            element.estadoId === const.EST_CONV_DES,
          statusCancelado:
            element.estadoId === const.EST_CONV_CANCEL,
          statusCulminado: element.estadoId === const.EST_CONV_CULM,
          statusGenerado: element.estadoId === const.EST_CONV_GENER
        }"
      >
        <span>
          {{ element.estado | titlecase }}
        </span>
      </div>
    </td>
  </ng-container>

  <ng-container
    *ngFor="let tableColumn of tableColumns"
    [matColumnDef]="tableColumn.name"
  >
    <th
      *matHeaderCellDef
      scope="col"
      mat-header-cell
      [mat-sort-header]="tableColumn.name"
      [arrowPosition]="tableColumn.position === 'right' ? 'before' : 'after'"
      [ngStyle]="{
        width: tableColumn.width ? tableColumn.width : 'auto'
      }"
    >
      {{ tableColumn.name }}
    </th>

    <td
      *matCellDef="let element"
      mat-cell
      [class.text-right]="tableColumn.position == 'right'"
    >
      <div class="fs-13">
        <span
          [class]="fontSize"
          [ngStyle]="{ color: element | colorPipeGetter: tableColumn.dataKey }"
        >
          {{ element | dataPropertyGetter: tableColumn.dataKey }}
        </span>
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<div
  class="p-3 mat-elevation-z1"
  *ngIf="this.tableDataSource.filteredData.length === 0"
  style="background-color: white"
>
  No se encontraron resultados
</div>

<div class="row px-3 mt-3" *ngIf="showDownloadButton">
  <span style="flex: 1 0"></span>
  <button
    class="btn-excel px-4 py-1"
    mat-stroked-button
    (click)="exportData()"
    [disabled]="tableDataSource.filteredData.length === 0"
  >
    <span> Descargar Excel </span>
    <nb-icon icon="descargar"></nb-icon>
  </button>
</div>
